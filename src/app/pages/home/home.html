<div class="home-container">
  <div class="container">
    <div class="split-layout">
      <!-- LEFT SIDE: Device Creation Form -->
      <div class="form-section">
        <div class="form-header">
          <h2 class="form-title">Add New Device</h2>
          <p class="form-subtitle">Track your devices in 3 simple steps</p>
        </div>

        <!-- Stepper -->
        <div class="stepper">
          <div
            *ngFor="let step of [1, 2, 3]"
            class="step"
            [class.active]="currentStep === step"
            [class.completed]="currentStep > step"
            (click)="goToStep(step)"
          >
            <div class="step-circle">
              <span *ngIf="currentStep <= step" class="step-number">{{ step }}</span>
              <span *ngIf="currentStep > step" class="step-check">‚úì</span>
            </div>
            <div class="step-label">
              <span *ngIf="step === 1">Basic Info</span>
              <span *ngIf="step === 2">Warranty</span>
              <span *ngIf="step === 3">Details</span>
            </div>
          </div>
        </div>

        <!-- Form -->
        <form [formGroup]="deviceForm" class="device-form">
          <!-- Step 1: Basic Info -->
          <div *ngIf="currentStep === 1" class="form-step">
            <div class="form-group">
              <label class="form-label">Device Name *</label>
              <input
                type="text"
                formControlName="name"
                class="form-input"
                [class.invalid]="isFieldInvalid('name')"
                placeholder="e.g., MacBook Pro 16&quot;"
              />
              <span *ngIf="isFieldInvalid('name')" class="error-message">
                Device name is required
              </span>
            </div>

            <div class="form-group">
              <label class="form-label">Category *</label>
              <select
                formControlName="category"
                class="form-input"
                [class.invalid]="isFieldInvalid('category')"
              >
                <option value="">Select category</option>
                <option *ngFor="let cat of categories" [value]="cat.value">
                  {{ cat.label }} {{ cat.emoji }}
                </option>
              </select>
              <span *ngIf="isFieldInvalid('category')" class="error-message">
                Category is required
              </span>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label class="form-label">Manufacturer</label>
                <input
                  type="text"
                  formControlName="manufacturer"
                  class="form-input"
                  placeholder="e.g., Apple"
                />
              </div>

              <div class="form-group">
                <label class="form-label">Model</label>
                <input
                  type="text"
                  formControlName="model"
                  class="form-input"
                  placeholder="e.g., M3 Max"
                />
              </div>
            </div>
          </div>

          <!-- Step 2: Purchase & Warranty -->
          <div *ngIf="currentStep === 2" class="form-step">
            <div class="form-row">
              <div class="form-group">
                <label class="form-label">Purchase Date *</label>
                <input
                  type="date"
                  formControlName="purchaseDate"
                  class="form-input"
                  [class.invalid]="isFieldInvalid('purchaseDate')"
                />
                <span *ngIf="isFieldInvalid('purchaseDate')" class="error-message">
                  Purchase date is required
                </span>
              </div>

              <div class="form-group">
                <label class="form-label">Purchase Price</label>
                <input
                  type="number"
                  formControlName="purchasePrice"
                  class="form-input"
                  placeholder="0"
                  step="0.01"
                />
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label class="form-label">Warranty Expires *</label>
                <input
                  type="date"
                  formControlName="warrantyExpires"
                  class="form-input"
                  [class.invalid]="isFieldInvalid('warrantyExpires')"
                />
                <span *ngIf="isFieldInvalid('warrantyExpires')" class="error-message">
                  Warranty expiry date is required
                </span>
              </div>

              <div class="form-group">
                <label class="form-label">Warranty Provider</label>
                <input
                  type="text"
                  formControlName="warrantyProvider"
                  class="form-input"
                  placeholder="e.g., AppleCare+"
                />
              </div>
            </div>
          </div>

          <!-- Step 3: Additional Details -->
          <div *ngIf="currentStep === 3" class="form-step">
            <div class="form-group">
              <label class="form-label">Serial Number</label>
              <input
                type="text"
                formControlName="serialNumber"
                class="form-input"
                placeholder="e.g., C02YX3ABMD6T"
              />
            </div>

            <div class="form-group">
              <label class="form-label">Notes</label>
              <textarea
                formControlName="notes"
                class="form-input form-textarea"
                rows="4"
                placeholder="Add any additional notes about this device..."
              ></textarea>
            </div>
          </div>

          <!-- Form Actions -->
          <div class="form-actions">
            <gc-button
              *ngIf="currentStep > 1"
              variant="secondary"
              (onClick)="previousStep()"
              [disabled]="isSaving"
            >
              Back
            </gc-button>

            <gc-button
              variant="primary"
              (onClick)="nextStep()"
              [disabled]="isSaving"
              class="next-button"
            >
              <span *ngIf="currentStep < totalSteps">Next Step</span>
              <span *ngIf="currentStep === totalSteps && !isSaving">Create Device</span>
              <span *ngIf="isSaving">Creating...</span>
            </gc-button>
          </div>
        </form>
      </div>

      <!-- RIGHT SIDE: Device List -->
      <div class="list-section">
        <div class="list-header">
          <h2 class="list-title">Recent Devices</h2>
          <span class="device-count">{{ devices.length }} device{{ devices.length !== 1 ? 's' : '' }}</span>
        </div>

        <!-- Loading State -->
        <div *ngIf="isLoading" class="loading-state">
          <div class="spinner"></div>
          <p>Loading devices...</p>
        </div>

        <!-- Empty State -->
        <div *ngIf="!isLoading && devices.length === 0" class="empty-state">
          <div class="empty-icon">üì¶</div>
          <h3>No devices yet</h3>
          <p>Create your first device using the form on the left</p>
        </div>

        <!-- Device List -->
        <div *ngIf="!isLoading && devices.length > 0" class="device-list">
          <div *ngFor="let device of devices" class="device-card">
            <div class="device-info">
              <div class="device-icon">{{ device.image || 'üì¶' }}</div>
              <div class="device-details">
                <h3 class="device-name">{{ device.name }}</h3>
                <p class="device-meta">
                  {{ device.manufacturer }} {{ device.model }}
                </p>
                <div class="device-status">
                  <span class="status-badge" [ngClass]="getStatusClass(device.status)">
                    {{ getStatusLabel(device.status) }}
                  </span>
                  <span class="warranty-date">
                    Expires {{ formatDate(device.warrantyExpires) }}
                  </span>
                </div>
              </div>
            </div>

            <div class="device-actions">
              <button
                class="action-btn view-btn"
                (click)="viewDevice(device)"
                title="View Details"
              >
                üëÅÔ∏è
              </button>
              <button
                class="action-btn edit-btn"
                (click)="editDevice(device)"
                title="Edit"
              >
                ‚úèÔ∏è
              </button>
              <button
                class="action-btn docs-btn"
                (click)="viewDocuments(device)"
                title="Documents"
              >
                üìÑ
              </button>
              <button
                class="action-btn delete-btn"
                (click)="deleteDevice(device)"
                title="Delete"
              >
                üóëÔ∏è
              </button>
            </div>
          </div>
        </div>

        <!-- View All Link -->
        <div *ngIf="!isLoading && devices.length > 0" class="view-all">
          <a routerLink="/dashboard" class="view-all-link">
            View all devices ‚Üí
          </a>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Auth Dialogs -->
<gc-login-dialog
  [isOpen]="isLoginDialogOpen"
  (close)="closeLoginDialog()"
  (switchToSignup)="switchToSignup()"
  (loginSuccess)="onLoginSuccess()"
></gc-login-dialog>

<gc-signup-dialog
  [isOpen]="isSignupDialogOpen"
  (close)="closeSignupDialog()"
  (switchToLogin)="switchToLogin()"
  (signupSuccess)="onSignupSuccess()"
></gc-signup-dialog>
