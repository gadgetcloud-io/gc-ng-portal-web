<div class="interactive-demo">
  <!-- Step Indicator -->
  <div class="step-indicator">
    <div
      class="step-item"
      [class.active]="currentStep === 'info'"
      [class.completed]="isStepCompleted('info')"
      (click)="goToStep('info')"
    >
      <div class="step-circle">
        <span class="step-icon" *ngIf="!isStepCompleted('info')">1</span>
        <span class="step-icon checkmark" *ngIf="isStepCompleted('info')">âœ“</span>
      </div>
      <div class="step-label">Device Info</div>
    </div>

    <div class="step-connector" [class.completed]="isStepCompleted('info')"></div>

    <div
      class="step-item"
      [class.active]="currentStep === 'photo'"
      [class.completed]="isStepCompleted('photo')"
      (click)="goToStep('photo')"
    >
      <div class="step-circle">
        <span class="step-icon" *ngIf="!isStepCompleted('photo')">2</span>
        <span class="step-icon checkmark" *ngIf="isStepCompleted('photo')">âœ“</span>
      </div>
      <div class="step-label">Photo (Optional)</div>
    </div>

    <div class="step-connector" [class.completed]="canGoToResults()"></div>

    <div
      class="step-item"
      [class.active]="currentStep === 'results'"
      [class.completed]="isStepCompleted('results')"
      [class.disabled]="!canGoToResults()"
      (click)="canGoToResults() && goToStep('results')"
    >
      <div class="step-circle">
        <span class="step-icon" *ngIf="!isStepCompleted('results')">3</span>
        <span class="step-icon checkmark" *ngIf="isStepCompleted('results')">âœ“</span>
      </div>
      <div class="step-label">Your Gadgets</div>
    </div>
  </div>

  <!-- Step 1: Device Info Form -->
  <div class="demo-step" *ngIf="currentStep === 'info'">
    <div class="step-header">
      <h3 class="step-title">ğŸ“± {{ addedDevices.length === 0 ? 'Add Your First Gadget' : 'Add Your Next Gadget' }}</h3>
      <p class="step-description">
        Enter your device details below. Takes less than 30 seconds!
      </p>
    </div>

    <form [formGroup]="deviceForm" class="device-form">
      <!-- Device Name -->
      <div class="form-group">
        <label for="name" class="form-label">Device Name *</label>
        <input
          id="name"
          type="text"
          formControlName="name"
          class="form-control"
          placeholder="e.g. MacBook Pro 2023, iPhone 15 Pro, Samsung Galaxy S24"
          (input)="onDeviceNameChange()"
        />
        <div
          class="form-error"
          *ngIf="deviceForm.get('name')?.invalid && deviceForm.get('name')?.touched"
        >
          Please enter a device name (min 2 characters)
        </div>
      </div>

      <!-- Category Selection -->
      <div class="form-group">
        <label for="category" class="form-label">Category *</label>
        <select id="category" formControlName="category" class="form-control">
          <option *ngFor="let cat of categories" [value]="cat.value">
            {{ cat.icon }} {{ cat.label }}
          </option>
        </select>
        <p class="form-hint" *ngIf="fieldsAutoDetected">
          âœ¨ Auto-detected from device name
        </p>
      </div>

      <!-- Brand -->
      <div class="form-group">
        <label for="brand" class="form-label">Brand</label>
        <input
          id="brand"
          type="text"
          formControlName="brand"
          class="form-control"
          placeholder="e.g. Apple, Dell, Samsung"
        />
        <p class="form-hint" *ngIf="fieldsAutoDetected">
          âœ¨ Auto-detected from device name
        </p>
      </div>

      <!-- Purchase Date and Warranty -->
      <div class="form-row">
        <div class="form-group">
          <label for="purchaseDate" class="form-label">Purchase Date *</label>
          <input
            id="purchaseDate"
            type="date"
            formControlName="purchaseDate"
            class="form-control"
          />
        </div>

        <div class="form-group">
          <label for="warrantyMonths" class="form-label">Warranty (months) *</label>
          <input
            id="warrantyMonths"
            type="number"
            formControlName="warrantyMonths"
            class="form-control"
            min="0"
            max="120"
          />
        </div>
      </div>

      <!-- Purchase Price -->
      <div class="form-group">
        <label for="purchasePrice" class="form-label">Purchase Price (â‚¹) *</label>
        <input
          id="purchasePrice"
          type="number"
          formControlName="purchasePrice"
          class="form-control"
          min="0"
          step="100"
          placeholder="0"
        />
      </div>

      <!-- Action Buttons -->
      <div class="form-actions">
        <button
          type="button"
          class="btn btn-secondary"
          (click)="goToStep('photo')"
        >
          ğŸ“¸ Add Photo (Optional)
        </button>
        <button
          type="button"
          class="btn btn-primary"
          (click)="submitDevice()"
          [disabled]="deviceForm.invalid"
        >
          âœ… Add Gadget
        </button>
      </div>
    </form>
  </div>

  <!-- Step 2: Photo Upload -->
  <div class="demo-step" *ngIf="currentStep === 'photo'">
    <div class="step-header">
      <h3 class="step-title">ğŸ“¸ Upload a Photo (Optional)</h3>
      <p class="step-description">
        Our AI can extract device details from photos. Try it out!
      </p>
    </div>

    <div class="photo-upload-zone">
      <!-- Photo Preview -->
      <div class="photo-preview" *ngIf="photoPreview">
        <img [src]="photoPreview" alt="Device photo" />
        <button type="button" class="remove-photo" (click)="removePhoto()">
          âœ• Remove
        </button>
      </div>

      <!-- Upload Area -->
      <div class="upload-area" *ngIf="!photoPreview">
        <div class="upload-icon">ğŸ“·</div>
        <p class="upload-text">Click to upload or drag & drop</p>
        <p class="upload-hint">PNG, JPG up to 5MB</p>
        <input
          type="file"
          id="photo-input"
          accept="image/*"
          (change)="onPhotoSelected($event)"
          class="file-input"
        />
        <label for="photo-input" class="upload-button">Choose File</label>
      </div>

      <!-- AI Analysis Button -->
      <div class="ai-actions" *ngIf="photoPreview && !isAnalyzing && !analysisResult && !analysisError">
        <button
          type="button"
          class="btn btn-primary"
          (click)="analyzePhoto()"
        >
          ğŸ¤– Extract Details with AI
        </button>
      </div>

      <!-- Analyzing State -->
      <div class="analyzing-state" *ngIf="isAnalyzing">
        <div class="spinner"></div>
        <p>Analyzing photo...</p>
      </div>

      <!-- Analysis Results -->
      <div class="analysis-results" *ngIf="analysisResult && !isAnalyzing">
        <div class="results-header">
          <h4>âœ… AI Analysis Complete</h4>
        </div>

        <div class="results-content">
          <!-- Brand -->
          <div class="result-item" *ngIf="analysisResult.brand">
            <span class="result-label">Brand:</span>
            <span class="result-value">{{ analysisResult.brand }}</span>
            <span class="confidence-badge" *ngIf="analysisResult.confidence?.brand != null">
              {{ (analysisResult.confidence.brand! * 100) | number:'1.0-0' }}% confidence
            </span>
          </div>

          <!-- Model -->
          <div class="result-item" *ngIf="analysisResult.model">
            <span class="result-label">Model:</span>
            <span class="result-value">{{ analysisResult.model }}</span>
            <span class="confidence-badge" *ngIf="analysisResult.confidence?.model != null">
              {{ (analysisResult.confidence.model! * 100) | number:'1.0-0' }}% confidence
            </span>
          </div>

          <!-- Serial Number -->
          <div class="result-item" *ngIf="analysisResult.serialNumber">
            <span class="result-label">Serial Number:</span>
            <span class="result-value">{{ analysisResult.serialNumber }}</span>
            <span class="confidence-badge" *ngIf="analysisResult.confidence?.serialNumber != null">
              {{ (analysisResult.confidence.serialNumber! * 100) | number:'1.0-0' }}% confidence
            </span>
          </div>

          <!-- No data extracted -->
          <div class="result-item" *ngIf="!analysisResult.brand && !analysisResult.model && !analysisResult.serialNumber">
            <span class="result-value">No device information could be extracted. Please enter details manually.</span>
          </div>
        </div>

        <div class="results-actions">
          <button
            type="button"
            class="btn btn-primary"
            (click)="applyAnalysisToForm()"
            *ngIf="analysisResult.brand || analysisResult.model"
          >
            âœ… Apply to Form
          </button>
          <button
            type="button"
            class="btn btn-secondary"
            (click)="analyzePhoto()"
          >
            ğŸ”„ Re-analyze
          </button>
        </div>
      </div>

      <!-- Analysis Error -->
      <div class="analysis-error" *ngIf="analysisError && !isAnalyzing">
        <div class="error-icon">âš ï¸</div>
        <p class="error-message">{{ analysisError }}</p>
        <button
          type="button"
          class="btn btn-secondary"
          (click)="analyzePhoto()"
        >
          ğŸ”„ Try Again
        </button>
      </div>
    </div>

    <!-- Navigation -->
    <div class="form-actions">
      <button
        type="button"
        class="btn btn-secondary"
        (click)="goToStep('info')"
      >
        â† Back to Info
      </button>
      <button
        type="button"
        class="btn btn-primary"
        (click)="submitDevice()"
        [disabled]="deviceForm.invalid"
      >
        âœ… Add Gadget
      </button>
    </div>
  </div>

  <!-- Step 3: Results -->
  <div class="demo-step" *ngIf="currentStep === 'results'">
    <div class="step-header">
      <h3 class="step-title">ğŸ‰ Your Gadgets</h3>
      <p class="step-description">
        You've added {{ addedDevices.length }} gadget{{ addedDevices.length !== 1 ? 's' : '' }}!
        Sign up to save them permanently.
      </p>
    </div>

    <!-- Results Grid -->
    <div class="results-grid">
      <div
        class="result-card"
        *ngFor="let device of addedDevices"
      >
        <!-- Photo -->
        <div class="card-photo" *ngIf="device.photoUrl">
          <img [src]="device.photoUrl" [alt]="device.name" />
        </div>
        <div class="card-photo-placeholder" *ngIf="!device.photoUrl">
          <span class="placeholder-icon">{{ getCategoryIcon(device.category) }}</span>
        </div>

        <!-- Content -->
        <div class="card-content">
          <div class="card-header">
            <h4 class="card-title">{{ device.name }}</h4>
            <button
              type="button"
              class="delete-btn"
              (click)="deleteDevice(device.id)"
              title="Delete"
            >
              ğŸ—‘ï¸
            </button>
          </div>

          <div class="card-meta">
            <span class="meta-item">
              ğŸ¢ {{ device.brand }}
            </span>
            <span class="meta-item">
              ğŸ“… Purchased: {{ device.purchaseDate | date:'MMM yyyy' }}
            </span>
            <span class="meta-item">
              ğŸ’° â‚¹{{ device.purchasePrice | number:'1.0-0' }}
            </span>
          </div>

          <!-- Warranty Status -->
          <div class="warranty-status">
            <div class="status-badge" [class.expiring]="isWarrantyExpiring(device)" [class.expired]="isWarrantyExpired(device)">
              <span *ngIf="!isWarrantyExpired(device)">
                âœ… Warranty until {{ device.warrantyExpiry | date:'MMM d, yyyy' }}
              </span>
              <span *ngIf="isWarrantyExpired(device)">
                âš ï¸ Warranty expired
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Action Buttons -->
    <div class="results-actions">
      <button
        type="button"
        class="btn btn-secondary"
        (click)="addAnother()"
      >
        â• Add Another Gadget
      </button>
      <button
        type="button"
        class="btn btn-ghost"
        (click)="resetDemo()"
      >
        ğŸ”„ Reset Demo
      </button>
    </div>
  </div>
</div>
