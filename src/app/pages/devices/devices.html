<!-- Page Header -->
<section class="page-header">
  <div class="container">
    <div class="header-content">
      <div class="header-text">
        <h1 class="page-title">My Gadgets</h1>
        <p class="page-subtitle">Manage all your gadgets and warranties in one place</p>
      </div>
      <div class="header-actions">
        <gc-button variant="secondary" size="md" (click)="openBulkImportDialog()">
          ğŸ“¤ Bulk Import
        </gc-button>
        <gc-button variant="primary" size="md" (click)="openAddDialog()">
          â• Add Gadget
        </gc-button>
      </div>
    </div>
  </div>
</section>

<!-- Stats Section -->
<section class="stats-section" *ngIf="!isLoading && devices.length > 0">
  <div class="container">
    <div class="stats-grid">
      <div class="stat-card stat-total">
        <div class="stat-icon">ğŸ“Š</div>
        <div class="stat-content">
          <div class="stat-value">{{ getStats().total }}</div>
          <div class="stat-label">Total Gadgets</div>
        </div>
      </div>

      <div class="stat-card stat-active">
        <div class="stat-icon">âœ“</div>
        <div class="stat-content">
          <div class="stat-value">{{ getStats().active }}</div>
          <div class="stat-label">Active Warranty</div>
        </div>
      </div>

      <div class="stat-card stat-warning">
        <div class="stat-icon">âš ï¸</div>
        <div class="stat-content">
          <div class="stat-value">{{ getStats().expiringSoon }}</div>
          <div class="stat-label">Expiring Soon</div>
        </div>
      </div>

      <div class="stat-card stat-expired">
        <div class="stat-icon">âœ•</div>
        <div class="stat-content">
          <div class="stat-value">{{ getStats().expired }}</div>
          <div class="stat-label">Expired</div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Filters Section -->
<section class="filters-section">
  <div class="container">
    <div class="filters-container">
      <div class="search-box">
        <input
          type="text"
          class="search-input"
          placeholder="Search gadgets by name, brand, or model..."
          [value]="searchTerm"
          (input)="onSearchChange($event)"
        />
        <span class="search-icon">ğŸ”</span>
      </div>

      <div class="filter-controls">
        <select class="filter-select" [value]="selectedCategory" (change)="onCategoryChange($event)">
          <option *ngFor="let category of categories" [value]="category.value">
            {{ category.label }}
          </option>
        </select>

        <select class="filter-select" [value]="selectedStatus" (change)="onStatusChange($event)">
          <option *ngFor="let status of statuses" [value]="status.value">
            {{ status.label }}
          </option>
        </select>
      </div>
    </div>

    <div class="results-count">
      <div class="select-all-container" *ngIf="filteredDevices.length > 0">
        <label class="select-all-label">
          <input
            type="checkbox"
            class="select-all-checkbox"
            [checked]="isAllSelected()"
            [indeterminate]="isSomeSelected()"
            (change)="toggleSelectAll()"
          />
          <span class="select-all-text">Select All</span>
        </label>
      </div>
      <span>{{ filteredDevices.length }} {{ filteredDevices.length === 1 ? 'gadget' : 'gadgets' }} found</span>
      <span *ngIf="getSelectedCount() > 0" class="selected-count">
        ({{ getSelectedCount() }} selected)
      </span>
    </div>
  </div>
</section>

<!-- Devices Grid -->
<section class="devices-section">
  <div class="container">
    <!-- Loading State -->
    <div *ngIf="isLoading" class="loading-state">
      <div class="spinner"></div>
      <p>Loading gadgets...</p>
    </div>

    <!-- Empty State -->
    <div *ngIf="!isLoading && filteredDevices.length === 0 && devices.length === 0" class="empty-state">
      <div class="empty-icon">ğŸ“±</div>
      <h2 class="empty-title">No gadgets yet</h2>
      <p class="empty-text">Start adding gadgets to keep track of warranties and documents</p>
      <gc-button variant="primary" size="lg" (click)="openAddDialog()">
        â• Add Your First Gadget
      </gc-button>
    </div>

    <!-- No Results State -->
    <div *ngIf="!isLoading && filteredDevices.length === 0 && devices.length > 0" class="empty-state">
      <div class="empty-icon">ğŸ”</div>
      <h2 class="empty-title">No gadgets match your filters</h2>
      <p class="empty-text">Try adjusting your search or filters</p>
    </div>

    <!-- Devices Grid -->
    <div *ngIf="!isLoading && filteredDevices.length > 0" class="devices-grid">
      <div *ngFor="let device of filteredDevices" class="device-card" [class.selected]="isDeviceSelected(device.id)" (click)="viewDevice(device)">
        <div class="device-select">
          <input
            type="checkbox"
            class="device-checkbox"
            [checked]="isDeviceSelected(device.id)"
            (change)="toggleDeviceSelection(device.id)"
            (click)="$event.stopPropagation()"
          />
        </div>

        <div class="device-icon">{{ getCategoryIcon(device.category) }}</div>

        <div class="device-header">
          <h3 class="device-name" title="Click to view details">
            {{ device.name }}
          </h3>
          <span class="device-status" [class]="getStatusColor(device.status)">
            {{ getStatusLabel(device.status) }}
          </span>
        </div>

        <div class="device-details">
          <div class="detail-row">
            <span class="detail-label">Manufacturer:</span>
            <span class="detail-value">{{ device.manufacturer }}</span>
          </div>
          <div class="detail-row" *ngIf="device.model">
            <span class="detail-label">Model:</span>
            <span class="detail-value">{{ device.model }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Category:</span>
            <span class="detail-value">{{ device.category }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Purchase Date:</span>
            <span class="detail-value">{{ formatDate(device.purchaseDate) }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Warranty Expires:</span>
            <span class="detail-value">{{ formatDate(device.warrantyExpires) }}</span>
          </div>
          <div class="detail-row" *ngIf="device.serialNumber">
            <span class="detail-label">Serial Number:</span>
            <span class="detail-value">{{ device.serialNumber }}</span>
          </div>
        </div>

        <div class="device-actions">
          <button class="action-btn action-btn-primary" (click)="viewDevice(device); $event.stopPropagation()" title="View details">
            <span class="btn-icon">ğŸ‘ï¸</span>
            <span class="btn-text">View</span>
          </button>
          <button class="action-btn action-btn-secondary" (click)="openDocumentsDialog(device); $event.stopPropagation()" title="Manage documents">
            <span class="btn-icon">ğŸ“</span>
            <span class="btn-text">Documents</span>
          </button>
          <button class="action-btn action-btn-repair" (click)="raiseRepairRequest(device); $event.stopPropagation()" title="Raise a repair request">
            <span class="btn-icon">ğŸ”§</span>
            <span class="btn-text">Repair Request</span>
          </button>
          <button class="action-btn action-btn-danger" (click)="openDeleteDialog(device); $event.stopPropagation()" title="Delete gadget">
            <span class="btn-icon">ğŸ—‘ï¸</span>
            <span class="btn-text">Delete</span>
          </button>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Dialogs -->
<gc-add-device-dialog
  [isOpen]="isAddDialogOpen"
  (close)="closeAddDialog()"
  (deviceAdded)="onDeviceAdded()"
></gc-add-device-dialog>

<gc-delete-device-dialog
  [isOpen]="isDeleteDialogOpen"
  [device]="selectedDevice"
  (close)="closeDeleteDialog()"
  (deviceDeleted)="onDeviceDeleted()"
></gc-delete-device-dialog>

<gc-upload-document-dialog
  [isOpen]="isUploadDocumentDialogOpen"
  [preselectedDeviceId]="selectedDeviceForDocs?.id"
  (close)="closeUploadDocumentDialog()"
  (documentUploaded)="onDocumentUploaded()"
></gc-upload-document-dialog>

<gc-view-documents-dialog
  [isOpen]="isViewDocumentsDialogOpen"
  [deviceId]="selectedDeviceForDocs?.id"
  [deviceName]="selectedDeviceForDocs?.name"
  (close)="closeViewDocumentsDialog()"
  (deleteDocument)="openDeleteDocumentDialog($event)"
  (uploadNew)="onUploadNewFromViewDialog()"
></gc-view-documents-dialog>

<gc-delete-document-dialog
  [isOpen]="isDeleteDocumentDialogOpen"
  [document]="selectedDocument"
  (close)="closeDeleteDocumentDialog()"
  (documentDeleted)="onDocumentDeleted()"
></gc-delete-document-dialog>

<!-- Bulk Action Bar -->
<gc-bulk-action-bar
  [selectedCount]="getSelectedCount()"
  (clearSelection)="clearSelection()"
  (bulkDelete)="onBulkDelete()"
  (bulkChangeStatus)="onBulkChangeStatus($event)"
></gc-bulk-action-bar>

<!-- Service Request Dialog -->
<gc-create-service-request-dialog
  [isOpen]="isServiceRequestDialogOpen"
  [device]="selectedDeviceForServiceRequest"
  (close)="closeServiceRequestDialog()"
  (requestCreated)="onServiceRequestCreated($event)"
></gc-create-service-request-dialog>

<!-- Bulk Import Dialog -->
<gc-bulk-import-dialog
  [isOpen]="isBulkImportDialogOpen"
  (close)="closeBulkImportDialog()"
  (importComplete)="onBulkImportComplete($event)"
></gc-bulk-import-dialog>
