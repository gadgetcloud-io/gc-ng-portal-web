<!-- Profile Page -->
<div class="profile-page">
  <!-- Header Section -->
  <section class="profile-header">
    <div class="container">
      <div class="header-content">
        <div class="user-avatar-large">{{ userInfo.avatar }}</div>
        <div class="user-info">
          <h1 class="user-name">{{ userInfo.firstName }} {{ userInfo.lastName }}</h1>
          <p class="user-email">{{ userInfo.email }}</p>
          <div class="user-badges">
            <span class="badge badge-primary">{{ userInfo.role }}</span>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Profile Content -->
  <div class="container">
    <!-- Alert Messages -->
    <div *ngIf="successMessage" class="alert alert-success">
      <span class="alert-icon">✓</span>
      <span class="alert-message">{{ successMessage }}</span>
    </div>

    <div *ngIf="errorMessage" class="alert alert-error">
      <span class="alert-icon">✗</span>
      <span class="alert-message">{{ errorMessage }}</span>
    </div>

    <div class="profile-grid">
      <!-- Personal Information -->
      <div class="profile-section">
        <div class="section-card">
          <div class="section-header">
            <h2 class="section-title">Personal Information</h2>
            <p class="section-description">Update your personal details and contact information</p>
          </div>

          <div class="section-content">
            <!-- First Name Field -->
            <div class="form-group">
              <label class="form-label">First Name</label>

              <!-- View Mode -->
              <div *ngIf="!editMode['firstName']" class="field-value-display">
                <span class="field-value">{{ userInfo.firstName }}</span>
                <button class="edit-button" (click)="enterEditMode('firstName')" title="Edit first name">
                  <span class="edit-icon">✎</span>
                </button>
              </div>

              <!-- Edit Mode -->
              <div *ngIf="editMode['firstName']" class="field-edit-mode">
                <input
                  type="text"
                  class="form-input"
                  [(ngModel)]="editValues['firstName']"
                  (ngModelChange)="onFieldChange()"
                  (keyup.enter)="saveField('firstName')"
                  (keyup.escape)="cancelEdit('firstName')"
                  [disabled]="isUpdating['firstName']"
                  placeholder="Enter first name"
                  autofocus
                />
                <button
                  class="save-button"
                  (click)="saveField('firstName')"
                  [disabled]="isUpdating['firstName']"
                  title="Save"
                >
                  <span class="button-icon">✓</span>
                </button>
                <button
                  class="cancel-button"
                  (click)="cancelEdit('firstName')"
                  [disabled]="isUpdating['firstName']"
                  title="Cancel"
                >
                  <span class="button-icon">✕</span>
                </button>
              </div>

              <span *ngIf="fieldErrors['firstName']" class="field-error">{{ fieldErrors['firstName'] }}</span>
            </div>

            <!-- Last Name Field -->
            <div class="form-group">
              <label class="form-label">Last Name</label>

              <!-- View Mode -->
              <div *ngIf="!editMode['lastName']" class="field-value-display">
                <span class="field-value">{{ userInfo.lastName }}</span>
                <button class="edit-button" (click)="enterEditMode('lastName')" title="Edit last name">
                  <span class="edit-icon">✎</span>
                </button>
              </div>

              <!-- Edit Mode -->
              <div *ngIf="editMode['lastName']" class="field-edit-mode">
                <input
                  type="text"
                  class="form-input"
                  [(ngModel)]="editValues['lastName']"
                  (ngModelChange)="onFieldChange()"
                  (keyup.enter)="saveField('lastName')"
                  (keyup.escape)="cancelEdit('lastName')"
                  [disabled]="isUpdating['lastName']"
                  placeholder="Enter last name"
                  autofocus
                />
                <button
                  class="save-button"
                  (click)="saveField('lastName')"
                  [disabled]="isUpdating['lastName']"
                  title="Save"
                >
                  <span class="button-icon">✓</span>
                </button>
                <button
                  class="cancel-button"
                  (click)="cancelEdit('lastName')"
                  [disabled]="isUpdating['lastName']"
                  title="Cancel"
                >
                  <span class="button-icon">✕</span>
                </button>
              </div>

              <span *ngIf="fieldErrors['lastName']" class="field-error">{{ fieldErrors['lastName'] }}</span>
            </div>

            <!-- Email Address Field (Read-Only) -->
            <div class="form-group">
              <label class="form-label">Email Address</label>
              <div class="field-value-display field-readonly">
                <span class="field-value">{{ userInfo.email }}</span>
                <span class="field-readonly-badge">Cannot be changed</span>
              </div>
            </div>

            <!-- Mobile Number Field -->
            <div class="form-group">
              <label class="form-label">Mobile Number</label>

              <!-- View Mode -->
              <div *ngIf="!editMode['mobile']" class="field-value-display">
                <span class="field-value">{{ userInfo.mobile || 'Not set' }}</span>
                <button class="edit-button" (click)="enterEditMode('mobile')" title="Edit mobile number">
                  <span class="edit-icon">✎</span>
                </button>
              </div>

              <!-- Edit Mode -->
              <div *ngIf="editMode['mobile']" class="field-edit-mode">
                <input
                  type="tel"
                  class="form-input"
                  [(ngModel)]="editValues['mobile']"
                  (ngModelChange)="onFieldChange()"
                  (keyup.enter)="saveField('mobile')"
                  (keyup.escape)="cancelEdit('mobile')"
                  [disabled]="isUpdating['mobile']"
                  placeholder="Enter mobile number"
                  autofocus
                />
                <button
                  class="save-button"
                  (click)="saveField('mobile')"
                  [disabled]="isUpdating['mobile']"
                  title="Save"
                >
                  <span class="button-icon">✓</span>
                </button>
                <button
                  class="cancel-button"
                  (click)="cancelEdit('mobile')"
                  [disabled]="isUpdating['mobile']"
                  title="Cancel"
                >
                  <span class="button-icon">✕</span>
                </button>
              </div>

              <span *ngIf="fieldErrors['mobile']" class="field-error">{{ fieldErrors['mobile'] }}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Account Settings -->
      <div class="profile-section">
        <div class="section-card">
          <div class="section-header">
            <h2 class="section-title">Account Settings</h2>
            <p class="section-description">Manage your account preferences and settings</p>
          </div>

          <div class="section-content">
            <div class="setting-item">
              <div class="setting-info">
                <h3 class="setting-title">Email Notifications</h3>
                <p class="setting-description">Receive email updates about your gadgets and services</p>
              </div>
              <label class="toggle-switch">
                <input type="checkbox" checked />
                <span class="toggle-slider"></span>
              </label>
            </div>

            <div class="setting-item">
              <div class="setting-info">
                <h3 class="setting-title">Marketing Communications</h3>
                <p class="setting-description">Receive news, tips, and special offers</p>
              </div>
              <label class="toggle-switch">
                <input type="checkbox" />
                <span class="toggle-slider"></span>
              </label>
            </div>

            <div class="setting-item">
              <div class="setting-info">
                <h3 class="setting-title">Weekly Reports</h3>
                <p class="setting-description">Get weekly summaries of your device activity</p>
              </div>
              <label class="toggle-switch">
                <input type="checkbox" checked />
                <span class="toggle-slider"></span>
              </label>
            </div>
          </div>
        </div>
      </div>

      <!-- Security Settings -->
      <div class="profile-section">
        <div class="section-card">
          <div class="section-header">
            <h2 class="section-title">Security</h2>
            <p class="section-description">Manage your password and security settings</p>
          </div>

          <div class="section-content">
            <!-- Password Change -->
            <div class="form-group">
              <label class="form-label">Password</label>

              <!-- View Mode -->
              <div *ngIf="!passwordEditMode" class="password-view">
                <span class="password-dots">••••••••</span>
                <button class="edit-button" (click)="enterPasswordEditMode()" title="Change password">
                  Change Password
                </button>
              </div>

              <!-- Password Edit Mode -->
              <div *ngIf="passwordEditMode" class="password-edit-mode">
                <div class="password-fields">
                  <div class="password-field-group">
                    <label class="password-field-label">Current Password</label>
                    <input
                      type="password"
                      class="form-input"
                      [(ngModel)]="passwordValues.current"
                      (ngModelChange)="onFieldChange()"
                      placeholder="Enter current password"
                      [disabled]="isUpdating['password']"
                    />
                  </div>

                  <div class="password-field-group">
                    <label class="password-field-label">New Password</label>
                    <input
                      type="password"
                      class="form-input"
                      [(ngModel)]="passwordValues.new"
                      (ngModelChange)="onFieldChange()"
                      placeholder="Enter new password (min 8 characters)"
                      [disabled]="isUpdating['password']"
                    />
                  </div>

                  <div class="password-field-group">
                    <label class="password-field-label">Confirm New Password</label>
                    <input
                      type="password"
                      class="form-input"
                      [(ngModel)]="passwordValues.confirm"
                      (ngModelChange)="onFieldChange()"
                      placeholder="Re-enter new password"
                      [disabled]="isUpdating['password']"
                    />
                  </div>
                </div>

                <div class="password-actions">
                  <button
                    class="password-save-button"
                    (click)="savePassword()"
                    [disabled]="isUpdating['password']"
                  >
                    {{ isUpdating['password'] ? 'Updating...' : 'Update Password' }}
                  </button>
                  <button
                    class="password-cancel-button"
                    (click)="cancelPasswordEdit()"
                    [disabled]="isUpdating['password']"
                  >
                    Cancel
                  </button>
                </div>

                <span *ngIf="fieldErrors['password']" class="field-error">{{ fieldErrors['password'] }}</span>
              </div>
            </div>

            <div class="security-divider"></div>

            <div class="security-item">
              <div class="security-info">
                <h3 class="security-title">Two-Factor Authentication</h3>
                <p class="security-status">Not enabled</p>
              </div>
              <gc-button variant="secondary" size="sm" (onClick)="toggleTwoFactor()">
                Enable 2FA
              </gc-button>
            </div>

            <div class="security-item">
              <div class="security-info">
                <h3 class="security-title">Active Sessions</h3>
                <p class="security-status">2 active sessions</p>
              </div>
              <gc-button variant="ghost" size="sm">
                View Sessions
              </gc-button>
            </div>
          </div>
        </div>
      </div>

      <!-- Account Info -->
      <div class="profile-section">
        <div class="section-card">
          <div class="section-header">
            <h2 class="section-title">Account Information</h2>
            <p class="section-description">Your account details and membership information</p>
          </div>

          <div class="section-content">
            <div class="info-item">
              <span class="info-label">Member Since</span>
              <span class="info-value">{{ userInfo.joinDate }}</span>
            </div>

            <div class="info-item">
              <span class="info-label">Account Type</span>
              <span class="info-value">{{ userInfo.role }}</span>
            </div>

            <div class="danger-zone">
              <h3 class="danger-title">Danger Zone</h3>
              <p class="danger-description">Permanently delete your account and all associated data</p>
              <gc-button variant="danger" size="sm">
                Delete Account
              </gc-button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Back to Home -->
  <div class="profile-footer">
    <gc-button variant="ghost" size="md" routerLink="/">
      ← Back to Home
    </gc-button>
  </div>
</div>
