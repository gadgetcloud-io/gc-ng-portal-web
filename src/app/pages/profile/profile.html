<!-- Success/Error Alerts -->
<div class="alert-container">
  <gc-alert
    *ngIf="successMessage"
    variant="success"
    [dismissible]="false"
  >
    {{ successMessage }}
  </gc-alert>

  <gc-alert
    *ngIf="errorMessage"
    variant="error"
    [dismissible]="false"
  >
    {{ errorMessage }}
  </gc-alert>
</div>

<!-- Profile Page -->
<div class="profile-page" *ngIf="user">
  <!-- Compact Header -->
  <div class="page-header">
    <a routerLink="/dashboard" class="btn-back-minimal">
      <span class="back-icon">‚Üê</span>
    </a>
    <div class="header-profile-info">
      <div class="profile-avatar-badge">
        <span class="profile-avatar-large">{{ userInfo.avatar }}</span>
      </div>
      <div class="profile-title-group">
        <h1 class="profile-name">{{ userInfo.firstName }} {{ userInfo.lastName }}</h1>
        <div class="profile-meta">
          <span class="meta-item">{{ userInfo.email }}</span>
        </div>
      </div>
      <div class="header-badges">
        <gc-badge variant="primary" size="md">{{ userInfo.role }}</gc-badge>
      </div>
    </div>
  </div>

  <!-- Tab Navigation -->
  <div class="tab-navigation">
    <div class="tab-pills">
      <button
        class="tab-pill"
        [class.active]="activeTab === 'profile'"
        (click)="switchTab('profile')">
        <span class="tab-icon">üìã</span>
        <span class="tab-label">Profile</span>
      </button>
      <button
        class="tab-pill"
        [class.active]="activeTab === 'preferences'"
        (click)="switchTab('preferences')">
        <span class="tab-icon">‚öôÔ∏è</span>
        <span class="tab-label">Preferences</span>
      </button>
      <button
        class="tab-pill"
        [class.active]="activeTab === 'security'"
        (click)="switchTab('security')">
        <span class="tab-icon">üîí</span>
        <span class="tab-label">Security</span>
      </button>
      <button
        class="tab-pill"
        [class.active]="activeTab === 'account'"
        (click)="switchTab('account')">
        <span class="tab-icon">üë§</span>
        <span class="tab-label">Account</span>
      </button>
    </div>
  </div>

  <!-- Tab Content -->
  <div class="tab-content">

    <!-- PROFILE TAB -->
    <div class="tab-pane" *ngIf="activeTab === 'profile'">
      <div class="profile-container">
        <gc-card variant="elevated" padding="lg">
          <div class="card-header">
            <h3>Personal Information</h3>
            <span class="card-icon">üìù</span>
          </div>
          <div class="card-content">
            <!-- First Name Field -->
            <div class="form-group">
              <label class="form-label">First Name</label>

              <!-- View Mode -->
              <div *ngIf="!editMode['firstName']" class="field-value-display">
                <span class="field-value">{{ userInfo.firstName }}</span>
                <button class="edit-button" (click)="enterEditMode('firstName')" title="Edit first name">
                  <span class="edit-icon">‚úé</span>
                </button>
              </div>

              <!-- Edit Mode -->
              <div *ngIf="editMode['firstName']" class="field-edit-mode">
                <input
                  type="text"
                  class="form-input"
                  [(ngModel)]="editValues['firstName']"
                  (ngModelChange)="onFieldChange()"
                  (keyup.enter)="saveField('firstName')"
                  (keyup.escape)="cancelEdit('firstName')"
                  [disabled]="isUpdating['firstName']"
                  placeholder="Enter first name"
                  autofocus
                />
                <button
                  class="save-button"
                  (click)="saveField('firstName')"
                  [disabled]="isUpdating['firstName']"
                  title="Save"
                >
                  <span class="button-icon">‚úì</span>
                </button>
                <button
                  class="cancel-button"
                  (click)="cancelEdit('firstName')"
                  [disabled]="isUpdating['firstName']"
                  title="Cancel"
                >
                  <span class="button-icon">‚úï</span>
                </button>
              </div>

              <span *ngIf="fieldErrors['firstName']" class="field-error">{{ fieldErrors['firstName'] }}</span>
            </div>

            <!-- Last Name Field -->
            <div class="form-group">
              <label class="form-label">Last Name</label>

              <!-- View Mode -->
              <div *ngIf="!editMode['lastName']" class="field-value-display">
                <span class="field-value">{{ userInfo.lastName }}</span>
                <button class="edit-button" (click)="enterEditMode('lastName')" title="Edit last name">
                  <span class="edit-icon">‚úé</span>
                </button>
              </div>

              <!-- Edit Mode -->
              <div *ngIf="editMode['lastName']" class="field-edit-mode">
                <input
                  type="text"
                  class="form-input"
                  [(ngModel)]="editValues['lastName']"
                  (ngModelChange)="onFieldChange()"
                  (keyup.enter)="saveField('lastName')"
                  (keyup.escape)="cancelEdit('lastName')"
                  [disabled]="isUpdating['lastName']"
                  placeholder="Enter last name"
                  autofocus
                />
                <button
                  class="save-button"
                  (click)="saveField('lastName')"
                  [disabled]="isUpdating['lastName']"
                  title="Save"
                >
                  <span class="button-icon">‚úì</span>
                </button>
                <button
                  class="cancel-button"
                  (click)="cancelEdit('lastName')"
                  [disabled]="isUpdating['lastName']"
                  title="Cancel"
                >
                  <span class="button-icon">‚úï</span>
                </button>
              </div>

              <span *ngIf="fieldErrors['lastName']" class="field-error">{{ fieldErrors['lastName'] }}</span>
            </div>

            <!-- Email Address Field (Read-Only) -->
            <div class="form-group">
              <label class="form-label">Email Address</label>
              <div class="field-value-display field-readonly">
                <span class="field-value">{{ userInfo.email }}</span>
                <span class="field-readonly-badge">Cannot be changed</span>
              </div>
            </div>

            <!-- Mobile Number Field -->
            <div class="form-group">
              <label class="form-label">Mobile Number</label>

              <!-- View Mode -->
              <div *ngIf="!editMode['mobile']" class="field-value-display">
                <span class="field-value">{{ userInfo.mobile || 'Not set' }}</span>
                <button class="edit-button" (click)="enterEditMode('mobile')" title="Edit mobile number">
                  <span class="edit-icon">‚úé</span>
                </button>
              </div>

              <!-- Edit Mode -->
              <div *ngIf="editMode['mobile']" class="field-edit-mode">
                <input
                  type="tel"
                  class="form-input"
                  [(ngModel)]="editValues['mobile']"
                  (ngModelChange)="onFieldChange()"
                  (keyup.enter)="saveField('mobile')"
                  (keyup.escape)="cancelEdit('mobile')"
                  [disabled]="isUpdating['mobile']"
                  placeholder="Enter mobile number"
                  autofocus
                />
                <button
                  class="save-button"
                  (click)="saveField('mobile')"
                  [disabled]="isUpdating['mobile']"
                  title="Save"
                >
                  <span class="button-icon">‚úì</span>
                </button>
                <button
                  class="cancel-button"
                  (click)="cancelEdit('mobile')"
                  [disabled]="isUpdating['mobile']"
                  title="Cancel"
                >
                  <span class="button-icon">‚úï</span>
                </button>
              </div>

              <span *ngIf="fieldErrors['mobile']" class="field-error">{{ fieldErrors['mobile'] }}</span>
            </div>
          </div>
        </gc-card>
      </div>
    </div>

    <!-- PREFERENCES TAB -->
    <div class="tab-pane" *ngIf="activeTab === 'preferences'">
      <div class="preferences-container">
        <gc-card variant="elevated" padding="lg">
          <div class="card-header">
            <h3>Notification Settings</h3>
            <span class="card-icon">üîî</span>
          </div>
          <div class="card-content">
            <div class="setting-item">
              <div class="setting-info">
                <h4 class="setting-title">Email Notifications</h4>
                <p class="setting-description">Receive email updates about your gadgets and services</p>
              </div>
              <label class="toggle-switch">
                <input type="checkbox" checked />
                <span class="toggle-slider"></span>
              </label>
            </div>

            <div class="setting-item">
              <div class="setting-info">
                <h4 class="setting-title">Marketing Communications</h4>
                <p class="setting-description">Receive news, tips, and special offers</p>
              </div>
              <label class="toggle-switch">
                <input type="checkbox" />
                <span class="toggle-slider"></span>
              </label>
            </div>

            <div class="setting-item">
              <div class="setting-info">
                <h4 class="setting-title">Weekly Reports</h4>
                <p class="setting-description">Get weekly summaries of your device activity</p>
              </div>
              <label class="toggle-switch">
                <input type="checkbox" checked />
                <span class="toggle-slider"></span>
              </label>
            </div>
          </div>
        </gc-card>
      </div>
    </div>

    <!-- SECURITY TAB -->
    <div class="tab-pane" *ngIf="activeTab === 'security'">
      <div class="security-container">
        <gc-card variant="elevated" padding="lg">
          <div class="card-header">
            <h3>Password & Authentication</h3>
            <span class="card-icon">üîê</span>
          </div>
          <div class="card-content">
            <!-- Password Change -->
            <div class="form-group">
              <label class="form-label">Password</label>

              <!-- View Mode -->
              <div *ngIf="!passwordEditMode" class="password-view">
                <span class="password-dots">‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢</span>
                <button class="edit-button" (click)="enterPasswordEditMode()" title="Change password">
                  Change Password
                </button>
              </div>

              <!-- Password Edit Mode -->
              <div *ngIf="passwordEditMode" class="password-edit-mode">
                <div class="password-fields">
                  <div class="password-field-group">
                    <label class="password-field-label">Current Password</label>
                    <input
                      type="password"
                      class="form-input"
                      [(ngModel)]="passwordValues.current"
                      (ngModelChange)="onFieldChange()"
                      placeholder="Enter current password"
                      [disabled]="isUpdating['password']"
                    />
                  </div>

                  <div class="password-field-group">
                    <label class="password-field-label">New Password</label>
                    <input
                      type="password"
                      class="form-input"
                      [(ngModel)]="passwordValues.new"
                      (ngModelChange)="onFieldChange()"
                      placeholder="Enter new password (min 8 characters)"
                      [disabled]="isUpdating['password']"
                    />
                  </div>

                  <div class="password-field-group">
                    <label class="password-field-label">Confirm New Password</label>
                    <input
                      type="password"
                      class="form-input"
                      [(ngModel)]="passwordValues.confirm"
                      (ngModelChange)="onFieldChange()"
                      placeholder="Re-enter new password"
                      [disabled]="isUpdating['password']"
                    />
                  </div>
                </div>

                <div class="password-actions">
                  <button
                    class="password-save-button"
                    (click)="savePassword()"
                    [disabled]="isUpdating['password']"
                  >
                    {{ isUpdating['password'] ? 'Updating...' : 'Update Password' }}
                  </button>
                  <button
                    class="password-cancel-button"
                    (click)="cancelPasswordEdit()"
                    [disabled]="isUpdating['password']"
                  >
                    Cancel
                  </button>
                </div>

                <span *ngIf="fieldErrors['password']" class="field-error">{{ fieldErrors['password'] }}</span>
              </div>
            </div>

            <div class="security-divider"></div>

            <div class="security-item">
              <div class="security-info">
                <h4 class="security-title">Two-Factor Authentication</h4>
                <p class="security-status">Not enabled</p>
              </div>
              <button class="btn-secondary-small" (click)="toggleTwoFactor()">
                Enable 2FA
              </button>
            </div>

            <div class="security-item">
              <div class="security-info">
                <h4 class="security-title">Active Sessions</h4>
                <p class="security-status">2 active sessions</p>
              </div>
              <button class="btn-ghost-small">
                View Sessions
              </button>
            </div>
          </div>
        </gc-card>
      </div>
    </div>

    <!-- ACCOUNT TAB -->
    <div class="tab-pane" *ngIf="activeTab === 'account'">
      <div class="account-container">
        <gc-card variant="elevated" padding="lg">
          <div class="card-header">
            <h3>Account Information</h3>
            <span class="card-icon">‚ÑπÔ∏è</span>
          </div>
          <div class="card-content">
            <div class="info-item">
              <span class="info-label">Member Since</span>
              <span class="info-value">{{ userInfo.joinDate }}</span>
            </div>

            <div class="info-item">
              <span class="info-label">Account Type</span>
              <span class="info-value">{{ userInfo.role }}</span>
            </div>

            <div class="danger-zone">
              <h4 class="danger-title">Danger Zone</h4>
              <p class="danger-description">Permanently delete your account and all associated data</p>
              <button class="btn-danger">
                Delete Account
              </button>
            </div>
          </div>
        </gc-card>
      </div>
    </div>
  </div>
</div>
