<!-- Success/Error Popovers -->
<div class="popover-container">
  <div *ngIf="updateSuccess" class="popover popover-success">
    <div class="popover-icon">âœ“</div>
    <div class="popover-message">{{ updateSuccess }}</div>
  </div>

  <div *ngIf="updateError" class="popover popover-error">
    <div class="popover-icon">âœ•</div>
    <div class="popover-message">{{ updateError }}</div>
  </div>
</div>

<!-- Loading State -->
<div class="loading-container" *ngIf="loading">
  <div class="loading-spinner"></div>
  <p>Loading device details...</p>
</div>

<!-- Error State -->
<div class="error-container" *ngIf="error && !loading">
  <div class="error-icon">âš ï¸</div>
  <h2>{{ error }}</h2>
  <a routerLink="/my-gadgets" class="btn-back">â† Back to My Gadgets</a>
</div>

<!-- Main Content -->
<div class="device-detail-page" *ngIf="device && !loading">
  <!-- Compact Header -->
  <div class="page-header">
    <a routerLink="/my-gadgets" class="btn-back-minimal">
      <span class="back-icon">â†</span>
    </a>
    <div class="header-device-info">
      <div class="device-icon-badge">
        <span class="device-icon-large">{{ getDeviceIcon() }}</span>
      </div>
      <div class="device-title-group">
        <h1 class="device-name">{{ device.name }}</h1>
        <div class="device-meta">
          <span class="meta-item">{{ device.manufacturer || 'Unknown' }}</span>
          <span class="meta-separator">â€¢</span>
          <span class="meta-item">{{ device.model || 'Unknown' }}</span>
        </div>
      </div>
      <div class="header-badges">
        <span class="status-pill" [ngClass]="getStatusClass()" *ngIf="device.status">
          {{ getStatusText() }}
        </span>
        <span class="price-pill" *ngIf="device.purchasePrice">
          {{ formatCurrency(device.purchasePrice) }}
        </span>
      </div>
    </div>
    <div class="header-actions">
      <button class="action-btn action-delete" (click)="deleteDevice()" title="Delete Device">
        <span class="action-icon">ğŸ—‘ï¸</span>
      </button>
    </div>
  </div>

  <!-- Tab Navigation -->
  <div class="tab-navigation">
    <div class="tab-pills">
      <button
        class="tab-pill"
        [class.active]="activeTabId === 'details'"
        (click)="onTabChange('details')">
        <span class="tab-icon">ğŸ“‹</span>
        <span class="tab-label">Details</span>
      </button>
      <button
        class="tab-pill"
        [class.active]="activeTabId === 'warranty'"
        (click)="onTabChange('warranty')">
        <span class="tab-icon">ğŸ›¡ï¸</span>
        <span class="tab-label">Warranty</span>
      </button>
      <button
        class="tab-pill"
        [class.active]="activeTabId === 'documents'"
        (click)="onTabChange('documents')">
        <span class="tab-icon">ğŸ“</span>
        <span class="tab-label">Documents</span>
      </button>
      <button
        class="tab-pill"
        [class.active]="activeTabId === 'notes'"
        (click)="onTabChange('notes')">
        <span class="tab-icon">ğŸ“</span>
        <span class="tab-label">Notes</span>
      </button>
      <button
        class="tab-pill"
        [class.active]="activeTabId === 'service-tickets'"
        (click)="onTabChange('service-tickets')">
        <span class="tab-icon">ğŸ”§</span>
        <span class="tab-label">Service Tickets</span>
      </button>
    </div>
  </div>

  <!-- Tab Content -->
  <div class="tab-content">
    <!-- Details Tab -->
    <div class="tab-pane" *ngIf="activeTabId === 'details'">
      <app-details-tab
        [device]="device"
        [fieldConfigs]="fieldConfigs"
        [loadingFieldConfigs]="loadingFieldConfigs"
        [isUpdating]="isUpdating"
        (fieldUpdate)="onFieldUpdate($event)">
      </app-details-tab>
    </div>

    <!-- Warranty Tab -->
    <div class="tab-pane" *ngIf="activeTabId === 'warranty'">
      <app-warranty-tab
        [device]="device"
        [fieldConfigs]="fieldConfigs"
        [loadingFieldConfigs]="loadingFieldConfigs"
        [isUpdating]="isUpdating"
        (fieldUpdate)="onFieldUpdate($event)">
      </app-warranty-tab>
    </div>

    <!-- Documents Tab -->
    <div class="tab-pane" *ngIf="activeTabId === 'documents'">
      <div class="documents-container">
        <div class="documents-header">
          <h3>Device Documents</h3>
          <p class="documents-hint">Upload receipts, manuals, warranty cards, and photos</p>
        </div>
        <app-documents-manager
          parentType="item"
          [parentId]="deviceId"
          [parentName]="device.name"
          [allowedDocumentTypes]="['receipt', 'invoice', 'warranty', 'photo', 'manual', 'other']">
        </app-documents-manager>
      </div>
    </div>

    <!-- Notes Tab -->
    <div class="tab-pane" *ngIf="activeTabId === 'notes'">
      <app-notes-tab
        [device]="device"
        [fieldConfigs]="fieldConfigs"
        [isUpdating]="isUpdating"
        (fieldUpdate)="onFieldUpdate($event)">
      </app-notes-tab>
    </div>

    <!-- Service Tickets Tab -->
    <div class="tab-pane" *ngIf="activeTabId === 'service-tickets'">
      <app-service-tickets-tab
        [device]="device">
      </app-service-tickets-tab>
    </div>
  </div>
</div>
