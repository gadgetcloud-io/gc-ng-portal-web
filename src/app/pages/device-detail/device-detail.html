<div class="device-detail-page">
  <!-- Loading State -->
  <div *ngIf="loading" class="loading-state">
    <div class="spinner"></div>
    <p>Loading gadget details...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !loading" class="error-state">
    <div class="error-icon">‚ö†Ô∏è</div>
    <h2>{{ error }}</h2>
    <a routerLink="/my-gadgets" class="back-link">‚Üê Back to My Gadgets</a>
  </div>

  <!-- Success/Error Popovers -->
  <div class="popover-container">
    <div *ngIf="updateSuccess" class="popover popover-success">
      <div class="popover-icon">‚úì</div>
      <div class="popover-message">{{ updateSuccess }}</div>
    </div>

    <div *ngIf="updateError" class="popover popover-error">
      <div class="popover-icon">‚úï</div>
      <div class="popover-message">{{ updateError }}</div>
    </div>
  </div>

  <!-- Device Details -->
  <div *ngIf="device && !loading" class="device-content">
    <!-- Header -->
    <div class="header">
      <a routerLink="/my-gadgets" class="back-link">
        <span class="back-icon">‚Üê</span>
        Back to My Gadgets
      </a>
      <div class="actions">
        <button class="btn btn-danger" (click)="deleteDevice()">
          <span class="btn-icon">üóëÔ∏è</span>
          Delete
        </button>
      </div>
    </div>

    <!-- Hero Section -->
    <div class="hero-section">
      <div class="gadget-image">
        <div class="image-container">
          {{ getDeviceIcon() }}
        </div>
      </div>
      <div class="gadget-info">
        <h1 class="gadget-name">{{ device.name }}</h1>
        <div class="gadget-price" *ngIf="device.purchasePrice">
          {{ formatCurrency(device.purchasePrice) }}
        </div>
        <p class="gadget-metadata">
          <span *ngIf="device.manufacturer">{{ device.manufacturer }}</span>
          <span *ngIf="device.manufacturer && device.model" class="separator">‚Ä¢</span>
          <span *ngIf="device.model">Model: {{ device.model }}</span>
        </p>
        <p class="gadget-metadata" *ngIf="device.serialNumber">
          <span class="label">Serial Number:</span>
          <span class="value">{{ device.serialNumber }}</span>
        </p>
        <div class="status-badge" [ngClass]="getStatusClass()">
          <span class="status-dot">‚óè</span>
          {{ getStatusText() }}
        </div>
      </div>
    </div>

    <!-- Specifications Section -->
    <div class="info-section">
      <h2 class="section-title">Specifications</h2>
      <div class="field-grid">
        <!-- Name Field -->
        <div class="field">
          <div class="field-label">Name</div>
          <div class="field-value-wrapper">
            <!-- Display Mode -->
            <div *ngIf="!editMode['name']" class="field-display-group">
              <div class="field-value">{{ getFieldDisplayValue('name') }}</div>
              <button
                *ngIf="isFieldEditable('name')"
                class="edit-icon-btn"
                (click)="enterEditMode('name')"
                [disabled]="isAnyFieldInEditMode()"
                title="Edit name"
              >
                ‚úèÔ∏è
              </button>
            </div>

            <!-- Edit Mode -->
            <div *ngIf="editMode['name']" class="field-edit-group">
              <input
                type="text"
                [(ngModel)]="editValues['name']"
                [maxlength]="fieldConfigs['name']?.maxLength ?? null"
                class="field-input"
                placeholder="Enter gadget name"
              />
              <button class="btn-save" (click)="saveField('name')" [disabled]="isUpdating">
                <span *ngIf="!isUpdating">‚úì</span>
                <span *ngIf="isUpdating" class="spinner-small"></span>
              </button>
              <button class="btn-cancel" (click)="cancelEdit('name')" [disabled]="isUpdating">‚úï</button>
            </div>
          </div>
        </div>

        <!-- Category Field -->
        <div class="field">
          <div class="field-label">Category</div>
          <div class="field-value-wrapper">
            <!-- Display Mode -->
            <div *ngIf="!editMode['category']" class="field-display-group">
              <div class="field-value">{{ getFieldDisplayValue('category') }}</div>
              <button
                *ngIf="isFieldEditable('category')"
                class="edit-icon-btn"
                (click)="enterEditMode('category')"
                [disabled]="isAnyFieldInEditMode()"
                title="Edit category"
              >
                ‚úèÔ∏è
              </button>
            </div>

            <!-- Edit Mode -->
            <div *ngIf="editMode['category']" class="field-edit-group">
              <select
                [(ngModel)]="editValues['category']"
                class="field-select"
              >
                <option *ngFor="let val of getAllowedValues('category')" [value]="val">
                  {{ formatFieldName(val) }}
                </option>
              </select>
              <button class="btn-save" (click)="saveField('category')" [disabled]="isUpdating">
                <span *ngIf="!isUpdating">‚úì</span>
                <span *ngIf="isUpdating" class="spinner-small"></span>
              </button>
              <button class="btn-cancel" (click)="cancelEdit('category')" [disabled]="isUpdating">‚úï</button>
            </div>
          </div>
        </div>

        <!-- Manufacturer Field -->
        <div class="field">
          <div class="field-label">Manufacturer</div>
          <div class="field-value-wrapper">
            <!-- Display Mode -->
            <div *ngIf="!editMode['manufacturer']" class="field-display-group">
              <div class="field-value">{{ getFieldDisplayValue('manufacturer') }}</div>
              <button
                *ngIf="isFieldEditable('manufacturer')"
                class="edit-icon-btn"
                (click)="enterEditMode('manufacturer')"
                [disabled]="isAnyFieldInEditMode()"
                title="Edit manufacturer"
              >
                ‚úèÔ∏è
              </button>
            </div>

            <!-- Edit Mode -->
            <div *ngIf="editMode['manufacturer']" class="field-edit-group">
              <input
                type="text"
                [(ngModel)]="editValues['manufacturer']"
                [maxlength]="fieldConfigs['manufacturer']?.maxLength ?? null"
                class="field-input"
                placeholder="Enter manufacturer"
              />
              <button class="btn-save" (click)="saveField('manufacturer')" [disabled]="isUpdating">
                <span *ngIf="!isUpdating">‚úì</span>
                <span *ngIf="isUpdating" class="spinner-small"></span>
              </button>
              <button class="btn-cancel" (click)="cancelEdit('manufacturer')" [disabled]="isUpdating">‚úï</button>
            </div>
          </div>
        </div>

        <!-- Model Field -->
        <div class="field">
          <div class="field-label">Model</div>
          <div class="field-value-wrapper">
            <!-- Display Mode -->
            <div *ngIf="!editMode['model']" class="field-display-group">
              <div class="field-value">{{ getFieldDisplayValue('model') }}</div>
              <button
                *ngIf="isFieldEditable('model')"
                class="edit-icon-btn"
                (click)="enterEditMode('model')"
                [disabled]="isAnyFieldInEditMode()"
                title="Edit model"
              >
                ‚úèÔ∏è
              </button>
            </div>

            <!-- Edit Mode -->
            <div *ngIf="editMode['model']" class="field-edit-group">
              <input
                type="text"
                [(ngModel)]="editValues['model']"
                [maxlength]="fieldConfigs['model']?.maxLength ?? null"
                class="field-input"
                placeholder="Enter model"
              />
              <button class="btn-save" (click)="saveField('model')" [disabled]="isUpdating">
                <span *ngIf="!isUpdating">‚úì</span>
                <span *ngIf="isUpdating" class="spinner-small"></span>
              </button>
              <button class="btn-cancel" (click)="cancelEdit('model')" [disabled]="isUpdating">‚úï</button>
            </div>
          </div>
        </div>

        <!-- Serial Number Field -->
        <div class="field">
          <div class="field-label">Serial Number</div>
          <div class="field-value-wrapper">
            <!-- Display Mode -->
            <div *ngIf="!editMode['serialNumber']" class="field-display-group">
              <div class="field-value">{{ getFieldDisplayValue('serialNumber') }}</div>
              <button
                *ngIf="isFieldEditable('serialNumber')"
                class="edit-icon-btn"
                (click)="enterEditMode('serialNumber')"
                [disabled]="isAnyFieldInEditMode()"
                title="Edit serial number"
              >
                ‚úèÔ∏è
              </button>
            </div>

            <!-- Edit Mode -->
            <div *ngIf="editMode['serialNumber']" class="field-edit-group">
              <input
                type="text"
                [(ngModel)]="editValues['serialNumber']"
                [maxlength]="fieldConfigs['serialNumber']?.maxLength ?? null"
                class="field-input"
                placeholder="Enter serial number"
              />
              <button class="btn-save" (click)="saveField('serialNumber')" [disabled]="isUpdating">
                <span *ngIf="!isUpdating">‚úì</span>
                <span *ngIf="isUpdating" class="spinner-small"></span>
              </button>
              <button class="btn-cancel" (click)="cancelEdit('serialNumber')" [disabled]="isUpdating">‚úï</button>
            </div>
          </div>
        </div>

        <!-- Status Field -->
        <div class="field">
          <div class="field-label">Status</div>
          <div class="field-value-wrapper">
            <!-- Display Mode -->
            <div *ngIf="!editMode['status']" class="field-display-group">
              <div class="field-value">
                <span class="status-badge" [ngClass]="getStatusClass()">
                  {{ getStatusText() }}
                </span>
              </div>
              <button
                *ngIf="isFieldEditable('status')"
                class="edit-icon-btn"
                (click)="enterEditMode('status')"
                [disabled]="isAnyFieldInEditMode()"
                title="Edit status"
              >
                ‚úèÔ∏è
              </button>
            </div>

            <!-- Edit Mode -->
            <div *ngIf="editMode['status']" class="field-edit-group">
              <select
                [(ngModel)]="editValues['status']"
                class="field-select"
              >
                <option *ngFor="let val of getAllowedValues('status')" [value]="val">
                  {{ formatFieldName(val) }}
                </option>
              </select>
              <button class="btn-save" (click)="saveField('status')" [disabled]="isUpdating">
                <span *ngIf="!isUpdating">‚úì</span>
                <span *ngIf="isUpdating" class="spinner-small"></span>
              </button>
              <button class="btn-cancel" (click)="cancelEdit('status')" [disabled]="isUpdating">‚úï</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Purchase & Warranty Section -->
    <div class="info-section">
      <h2 class="section-title">Purchase & Warranty Information</h2>
      <div class="field-grid">
        <!-- Purchase Date Field -->
        <div class="field">
          <div class="field-label">Purchase Date</div>
          <div class="field-value-wrapper">
            <!-- Display Mode -->
            <div *ngIf="!editMode['purchaseDate']" class="field-display-group">
              <div class="field-value">{{ getFieldDisplayValue('purchaseDate') }}</div>
              <button
                *ngIf="isFieldEditable('purchaseDate')"
                class="edit-icon-btn"
                (click)="enterEditMode('purchaseDate')"
                [disabled]="isAnyFieldInEditMode()"
                title="Edit purchase date"
              >
                ‚úèÔ∏è
              </button>
            </div>

            <!-- Edit Mode -->
            <div *ngIf="editMode['purchaseDate']" class="field-edit-group">
              <input
                type="date"
                [(ngModel)]="editValues['purchaseDate']"
                class="field-input"
              />
              <button class="btn-save" (click)="saveField('purchaseDate')" [disabled]="isUpdating">
                <span *ngIf="!isUpdating">‚úì</span>
                <span *ngIf="isUpdating" class="spinner-small"></span>
              </button>
              <button class="btn-cancel" (click)="cancelEdit('purchaseDate')" [disabled]="isUpdating">‚úï</button>
            </div>
          </div>
        </div>

        <!-- Purchase Price Field -->
        <div class="field">
          <div class="field-label">Purchase Price</div>
          <div class="field-value-wrapper">
            <!-- Display Mode -->
            <div *ngIf="!editMode['purchasePrice']" class="field-display-group">
              <div class="field-value">{{ getFieldDisplayValue('purchasePrice') }}</div>
              <button
                *ngIf="isFieldEditable('purchasePrice')"
                class="edit-icon-btn"
                (click)="enterEditMode('purchasePrice')"
                [disabled]="isAnyFieldInEditMode()"
                title="Edit purchase price"
              >
                ‚úèÔ∏è
              </button>
            </div>

            <!-- Edit Mode -->
            <div *ngIf="editMode['purchasePrice']" class="field-edit-group">
              <input
                type="number"
                [(ngModel)]="editValues['purchasePrice']"
                [min]="fieldConfigs['purchasePrice']?.min ?? null"
                [max]="fieldConfigs['purchasePrice']?.max ?? null"
                class="field-input"
                placeholder="Enter price"
                step="0.01"
              />
              <button class="btn-save" (click)="saveField('purchasePrice')" [disabled]="isUpdating">
                <span *ngIf="!isUpdating">‚úì</span>
                <span *ngIf="isUpdating" class="spinner-small"></span>
              </button>
              <button class="btn-cancel" (click)="cancelEdit('purchasePrice')" [disabled]="isUpdating">‚úï</button>
            </div>
          </div>
        </div>

        <!-- Warranty Expires Field -->
        <div class="field">
          <div class="field-label">Warranty Expires</div>
          <div class="field-value-wrapper">
            <!-- Display Mode -->
            <div *ngIf="!editMode['warrantyExpires']" class="field-display-group">
              <div class="field-value">{{ getFieldDisplayValue('warrantyExpires') }}</div>
              <button
                *ngIf="isFieldEditable('warrantyExpires')"
                class="edit-icon-btn"
                (click)="enterEditMode('warrantyExpires')"
                [disabled]="isAnyFieldInEditMode()"
                title="Edit warranty expiry"
              >
                ‚úèÔ∏è
              </button>
            </div>

            <!-- Edit Mode -->
            <div *ngIf="editMode['warrantyExpires']" class="field-edit-group">
              <input
                type="date"
                [(ngModel)]="editValues['warrantyExpires']"
                class="field-input"
              />
              <button class="btn-save" (click)="saveField('warrantyExpires')" [disabled]="isUpdating">
                <span *ngIf="!isUpdating">‚úì</span>
                <span *ngIf="isUpdating" class="spinner-small"></span>
              </button>
              <button class="btn-cancel" (click)="cancelEdit('warrantyExpires')" [disabled]="isUpdating">‚úï</button>
            </div>
          </div>
        </div>

        <!-- Warranty Provider Field -->
        <div class="field">
          <div class="field-label">Warranty Provider</div>
          <div class="field-value-wrapper">
            <!-- Display Mode -->
            <div *ngIf="!editMode['warrantyProvider']" class="field-display-group">
              <div class="field-value">{{ getFieldDisplayValue('warrantyProvider') }}</div>
              <button
                *ngIf="isFieldEditable('warrantyProvider')"
                class="edit-icon-btn"
                (click)="enterEditMode('warrantyProvider')"
                [disabled]="isAnyFieldInEditMode()"
                title="Edit warranty provider"
              >
                ‚úèÔ∏è
              </button>
            </div>

            <!-- Edit Mode -->
            <div *ngIf="editMode['warrantyProvider']" class="field-edit-group">
              <input
                type="text"
                [(ngModel)]="editValues['warrantyProvider']"
                [maxlength]="fieldConfigs['warrantyProvider']?.maxLength ?? null"
                class="field-input"
                placeholder="Enter warranty provider"
              />
              <button class="btn-save" (click)="saveField('warrantyProvider')" [disabled]="isUpdating">
                <span *ngIf="!isUpdating">‚úì</span>
                <span *ngIf="isUpdating" class="spinner-small"></span>
              </button>
              <button class="btn-cancel" (click)="cancelEdit('warrantyProvider')" [disabled]="isUpdating">‚úï</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Notes Section -->
    <div class="info-section">
      <h2 class="section-title">
        Notes
        <button
          *ngIf="isFieldEditable('notes') && !editMode['notes'] && !isAnyFieldInEditMode()"
          class="edit-icon-btn"
          (click)="enterEditMode('notes')"
          title="Edit notes"
        >
          ‚úèÔ∏è
        </button>
      </h2>

      <!-- Display Mode -->
      <div *ngIf="!editMode['notes']" class="notes-content">
        {{ device.notes || 'No notes added yet. Click the edit button to add notes.' }}
      </div>

      <!-- Edit Mode -->
      <div *ngIf="editMode['notes']" class="notes-edit-group">
        <textarea
          [(ngModel)]="editValues['notes']"
          [maxlength]="fieldConfigs['notes']?.maxLength ?? null"
          class="notes-textarea"
          placeholder="Add notes about this gadget..."
          rows="6"
        ></textarea>
        <div class="notes-actions">
          <button class="btn-save-large" (click)="saveField('notes')" [disabled]="isUpdating">
            <span *ngIf="!isUpdating">‚úì Save Notes</span>
            <span *ngIf="isUpdating">
              <span class="spinner-small"></span> Saving...
            </span>
          </button>
          <button class="btn-cancel-large" (click)="cancelEdit('notes')" [disabled]="isUpdating">‚úï Cancel</button>
        </div>
      </div>
    </div>

    <!-- Metadata Section -->
    <div class="info-section metadata-section">
      <h2 class="section-title">Record Information</h2>
      <div class="field-grid">
        <div class="field" *ngIf="device.createdAt">
          <div class="field-label">Created</div>
          <div class="field-value">{{ formatDate(device.createdAt) }}</div>
        </div>
        <div class="field" *ngIf="device.updatedAt">
          <div class="field-label">Last Updated</div>
          <div class="field-value">{{ formatDate(device.updatedAt) }}</div>
        </div>
      </div>
    </div>
  </div>
</div>
