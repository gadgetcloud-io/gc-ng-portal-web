<!-- Success/Error Alerts -->
<div class="alert-container">
  <gc-alert
    *ngIf="updateSuccess"
    variant="success"
    [dismissible]="false"
  >
    {{ updateSuccess }}
  </gc-alert>

  <gc-alert
    *ngIf="updateError"
    variant="error"
    [dismissible]="false"
  >
    {{ updateError }}
  </gc-alert>
</div>

<!-- Loading State -->
<div class="loading-container" *ngIf="loading">
  <gc-loading-spinner
    variant="primary"
    size="lg"
    label="Loading device details..."
    [centered]="true"
  ></gc-loading-spinner>
</div>

<!-- Error State -->
<div class="error-container" *ngIf="error && !loading">
  <gc-empty-state
    variant="error"
    icon="âš ï¸"
    [title]="error"
    description="Unable to load device details"
    actionText="â† Back to My Gadgets"
    (onAction)="router.navigate(['/my-gadgets'])"
    size="lg"
  ></gc-empty-state>
</div>

<!-- Main Content -->
<div class="device-detail-page" *ngIf="device && !loading">
  <!-- Compact Header -->
  <div class="page-header">
    <a routerLink="/my-gadgets" class="btn-back-minimal">
      <span class="back-icon">â†</span>
    </a>
    <div class="header-device-info">
      <div class="device-icon-badge">
        <span class="device-icon-large">{{ getDeviceIcon() }}</span>
      </div>
      <div class="device-title-group">
        <h1 class="device-name">{{ device.name }}</h1>
        <div class="device-meta">
          <span class="meta-item">{{ device.manufacturer || 'Unknown' }}</span>
          <span class="meta-separator">â€¢</span>
          <span class="meta-item">{{ device.model || 'Unknown' }}</span>
        </div>
      </div>
      <div class="header-badges">
        <gc-badge
          *ngIf="device.status"
          [variant]="device.status === 'active' ? 'success' : device.status === 'expiring-soon' ? 'warning' : device.status === 'expired' ? 'error' : 'default'"
          size="md"
        >
          {{ getStatusText() }}
        </gc-badge>
        <gc-badge
          *ngIf="device.purchasePrice"
          variant="info"
          size="md"
        >
          {{ formatCurrency(device.purchasePrice) }}
        </gc-badge>
      </div>
    </div>
    <div class="header-actions">
      <button class="action-btn action-delete" (click)="deleteDevice()" title="Delete Device">
        <span class="action-icon">ğŸ—‘ï¸</span>
      </button>
    </div>
  </div>

  <!-- Tab Navigation -->
  <div class="tab-navigation">
    <div class="tab-pills">
      <button
        class="tab-pill"
        [class.active]="activeTabId === 'details'"
        (click)="onTabChange('details')">
        <span class="tab-icon">ğŸ“‹</span>
        <span class="tab-label">Details</span>
      </button>
      <button
        class="tab-pill"
        [class.active]="activeTabId === 'warranty'"
        (click)="onTabChange('warranty')">
        <span class="tab-icon">ğŸ›¡ï¸</span>
        <span class="tab-label">Warranty</span>
      </button>
      <button
        class="tab-pill"
        [class.active]="activeTabId === 'documents'"
        (click)="onTabChange('documents')">
        <span class="tab-icon">ğŸ“</span>
        <span class="tab-label">Documents</span>
      </button>
      <button
        class="tab-pill"
        [class.active]="activeTabId === 'notes'"
        (click)="onTabChange('notes')">
        <span class="tab-icon">ğŸ“</span>
        <span class="tab-label">Notes</span>
      </button>
      <button
        class="tab-pill"
        [class.active]="activeTabId === 'service-tickets'"
        (click)="onTabChange('service-tickets')">
        <span class="tab-icon">ğŸ”§</span>
        <span class="tab-label">Service Tickets</span>
      </button>
    </div>
  </div>

  <!-- Tab Content -->
  <div class="tab-content">
    <!-- Details Tab -->
    <div class="tab-pane" *ngIf="activeTabId === 'details'">
      <app-details-tab
        [device]="device"
        [fieldConfigs]="fieldConfigs"
        [loadingFieldConfigs]="loadingFieldConfigs"
        [isUpdating]="isUpdating"
        (fieldUpdate)="onFieldUpdate($event)">
      </app-details-tab>
    </div>

    <!-- Warranty Tab -->
    <div class="tab-pane" *ngIf="activeTabId === 'warranty'">
      <app-warranty-tab
        [device]="device"
        [fieldConfigs]="fieldConfigs"
        [loadingFieldConfigs]="loadingFieldConfigs"
        [isUpdating]="isUpdating"
        (fieldUpdate)="onFieldUpdate($event)">
      </app-warranty-tab>
    </div>

    <!-- Documents Tab -->
    <div class="tab-pane" *ngIf="activeTabId === 'documents'">
      <div class="documents-container">
        <div class="documents-header">
          <h3>Device Documents</h3>
          <p class="documents-hint">Upload receipts, manuals, warranty cards, and photos</p>
        </div>
        <app-documents-manager
          parentType="item"
          [parentId]="deviceId"
          [parentName]="device.name"
          [allowedDocumentTypes]="['receipt', 'invoice', 'warranty', 'photo', 'manual', 'other']">
        </app-documents-manager>
      </div>
    </div>

    <!-- Notes Tab -->
    <div class="tab-pane" *ngIf="activeTabId === 'notes'">
      <app-notes-tab
        [device]="device"
        [fieldConfigs]="fieldConfigs"
        [isUpdating]="isUpdating"
        (fieldUpdate)="onFieldUpdate($event)">
      </app-notes-tab>
    </div>

    <!-- Service Tickets Tab -->
    <div class="tab-pane" *ngIf="activeTabId === 'service-tickets'">
      <app-service-tickets-tab
        [device]="device">
      </app-service-tickets-tab>
    </div>
  </div>
</div>
