<gc-modal [isOpen]="isOpen" [title]="'Add New Gadget'" [maxWidth]="'lg'" (close)="onClose()">
  <!-- Error Message -->
  <div *ngIf="error" class="error-message">
    {{ error }}
  </div>

  <!-- Stepper -->
  <div class="stepper">
    <div
      *ngFor="let step of [1, 2, 3]"
      class="step"
      [class.active]="currentStep === step"
      [class.completed]="currentStep > step"
      (click)="goToStep(step)"
    >
      <div class="step-circle">
        <span *ngIf="currentStep <= step" class="step-number">{{ step }}</span>
        <span *ngIf="currentStep > step" class="step-check">âœ“</span>
      </div>
      <div class="step-label">
        <span *ngIf="step === 1">Basic Info</span>
        <span *ngIf="step === 2">Warranty</span>
        <span *ngIf="step === 3">Details</span>
      </div>
    </div>
  </div>

  <!-- Form -->
  <form [formGroup]="deviceForm" class="device-form">
    <!-- Step 1: Basic Info -->
    <div *ngIf="currentStep === 1" class="form-step">
      <div class="form-group">
        <label class="form-label">Gadget Name *</label>
        <input
          type="text"
          formControlName="name"
          class="form-input"
          [class.invalid]="isFieldInvalid('name')"
          placeholder="e.g., MacBook Pro 16&quot;"
        />
        <span *ngIf="isFieldInvalid('name')" class="error-text">
          Gadget name is required
        </span>
      </div>

      <div class="form-group">
        <label class="form-label">Category *</label>
        <select
          formControlName="category"
          class="form-input"
          [class.invalid]="isFieldInvalid('category')"
        >
          <option value="">Select category</option>
          <option *ngFor="let cat of categories" [value]="cat.value">
            {{ cat.label }} {{ cat.emoji }}
          </option>
        </select>
        <span *ngIf="isFieldInvalid('category')" class="error-text">
          Category is required
        </span>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label class="form-label">Manufacturer</label>
          <input
            type="text"
            formControlName="manufacturer"
            class="form-input"
            placeholder="e.g., Apple"
          />
        </div>

        <div class="form-group">
          <label class="form-label">Model</label>
          <input
            type="text"
            formControlName="model"
            class="form-input"
            placeholder="e.g., M3 Max"
          />
        </div>
      </div>
    </div>

    <!-- Step 2: Purchase & Warranty -->
    <div *ngIf="currentStep === 2" class="form-step">
      <div class="form-row">
        <div class="form-group">
          <label class="form-label">Purchase Date *</label>
          <input
            type="date"
            formControlName="purchaseDate"
            class="form-input"
            [class.invalid]="isFieldInvalid('purchaseDate')"
          />
          <span *ngIf="isFieldInvalid('purchaseDate')" class="error-text">
            Purchase date is required
          </span>
        </div>

        <div class="form-group">
          <label class="form-label">Purchase Price</label>
          <div class="input-group">
            <span class="input-prefix">$</span>
            <input
              type="number"
              formControlName="purchasePrice"
              class="form-input"
              placeholder="0.00"
              min="0"
              step="0.01"
            />
          </div>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label class="form-label">Warranty Expires *</label>
          <input
            type="date"
            formControlName="warrantyExpires"
            class="form-input"
            [class.invalid]="isFieldInvalid('warrantyExpires')"
          />
          <span *ngIf="isFieldInvalid('warrantyExpires')" class="error-text">
            Warranty expiration is required
          </span>
        </div>

        <div class="form-group">
          <label class="form-label">Warranty Provider</label>
          <input
            type="text"
            formControlName="warrantyProvider"
            class="form-input"
            placeholder="e.g., AppleCare+"
          />
        </div>
      </div>
    </div>

    <!-- Step 3: Additional Details -->
    <div *ngIf="currentStep === 3" class="form-step">
      <div class="form-group">
        <label class="form-label">Serial Number</label>
        <input
          type="text"
          formControlName="serialNumber"
          class="form-input"
          placeholder="e.g., C02YX3ABMD6T"
        />
      </div>

      <div class="form-group">
        <label class="form-label">Notes</label>
        <textarea
          formControlName="notes"
          class="form-input form-textarea"
          rows="4"
          placeholder="Add any additional notes about this device..."
        ></textarea>
      </div>
    </div>

    <!-- Form Actions -->
    <div class="form-actions">
      <gc-button
        *ngIf="currentStep > 1"
        variant="secondary"
        (onClick)="previousStep()"
        [disabled]="isSubmitting"
      >
        Back
      </gc-button>

      <gc-button
        variant="primary"
        (onClick)="nextStep()"
        [disabled]="isSubmitting"
        class="next-button"
      >
        <span *ngIf="currentStep < totalSteps">Next Step</span>
        <span *ngIf="currentStep === totalSteps && !isSubmitting">Add Gadget</span>
        <span *ngIf="isSubmitting">Adding...</span>
      </gc-button>
    </div>
  </form>
</gc-modal>
