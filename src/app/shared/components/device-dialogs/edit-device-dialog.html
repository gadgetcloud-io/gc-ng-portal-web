<gc-modal [isOpen]="isOpen" [title]="'Edit Device'" [maxWidth]="'lg'" (close)="onClose()">
  <!-- Error Message -->
  <div *ngIf="error" class="error-message">
    {{ error }}
  </div>

  <!-- Tabs -->
  <div class="form-tabs">
    <button
      type="button"
      class="tab-button"
      [class.active]="currentTab === 'basic'"
      (click)="currentTab = 'basic'"
    >
      <span class="tab-icon">ğŸ“±</span>
      <span class="tab-label">Device Info</span>
    </button>
    <button
      type="button"
      class="tab-button"
      [class.active]="currentTab === 'purchase'"
      (click)="currentTab = 'purchase'"
    >
      <span class="tab-icon">ğŸ’°</span>
      <span class="tab-label">Purchase & Warranty</span>
    </button>
    <button
      type="button"
      class="tab-button"
      [class.active]="currentTab === 'notes'"
      (click)="currentTab = 'notes'"
    >
      <span class="tab-icon">ğŸ“</span>
      <span class="tab-label">Notes</span>
    </button>
    <button
      type="button"
      class="tab-button"
      [class.active]="currentTab === 'documents'"
      (click)="currentTab = 'documents'; loadDocuments()"
    >
      <span class="tab-icon">ğŸ“</span>
      <span class="tab-label">Documents</span>
    </button>
  </div>

  <form (ngSubmit)="onSubmit()" class="device-form">
    <!-- Tab 1: Basic Information -->
    <div *ngIf="currentTab === 'basic'" class="tab-content">

      <div class="form-group">
        <label for="name" class="form-label required">Device Name</label>
        <input
          type="text"
          id="name"
          name="name"
          class="form-input"
          [(ngModel)]="editedDevice.name"
          placeholder="e.g., MacBook Pro 16&quot;"
          required
        />
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="category" class="form-label required">Category</label>
          <select id="category" name="category" class="form-input" [(ngModel)]="editedDevice.category" required>
            <option value="">Select category...</option>
            <option *ngFor="let cat of categories" [value]="cat.value">{{ cat.label }} {{ cat.emoji }}</option>
          </select>
        </div>

        <div class="form-group">
          <label for="manufacturer" class="form-label">Manufacturer</label>
          <input
            type="text"
            id="manufacturer"
            name="manufacturer"
            class="form-input"
            [(ngModel)]="editedDevice.manufacturer"
            placeholder="e.g., Apple, Sony, Dell"
          />
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="model" class="form-label">Model</label>
          <input
            type="text"
            id="model"
            name="model"
            class="form-input"
            [(ngModel)]="editedDevice.model"
            placeholder="e.g., M3 Max, XM5"
          />
        </div>

        <div class="form-group">
          <label for="serialNumber" class="form-label">Serial Number</label>
          <input
            type="text"
            id="serialNumber"
            name="serialNumber"
            class="form-input"
            [(ngModel)]="editedDevice.serialNumber"
            placeholder="Serial number"
          />
        </div>
      </div>
    </div>

    <!-- Tab 2: Purchase & Warranty Information -->
    <div *ngIf="currentTab === 'purchase'" class="tab-content">

      <div class="form-row">
        <div class="form-group">
          <label for="purchaseDate" class="form-label required">Purchase Date</label>
          <input
            type="date"
            id="purchaseDate"
            name="purchaseDate"
            class="form-input"
            [(ngModel)]="editedDevice.purchaseDate"
            required
          />
        </div>

        <div class="form-group">
          <label for="purchasePrice" class="form-label">Purchase Price</label>
          <div class="input-group">
            <span class="input-prefix">$</span>
            <input
              type="number"
              id="purchasePrice"
              name="purchasePrice"
              class="form-input"
              [(ngModel)]="editedDevice.purchasePrice"
              placeholder="0.00"
              min="0"
              step="0.01"
            />
          </div>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="warrantyExpires" class="form-label required">Warranty Expiration</label>
          <input
            type="date"
            id="warrantyExpires"
            name="warrantyExpires"
            class="form-input"
            [(ngModel)]="editedDevice.warrantyExpires"
            required
          />
        </div>

        <div class="form-group">
          <label for="warrantyProvider" class="form-label">Warranty Provider</label>
          <input
            type="text"
            id="warrantyProvider"
            name="warrantyProvider"
            class="form-input"
            [(ngModel)]="editedDevice.warrantyProvider"
            placeholder="e.g., AppleCare+, Manufacturer"
          />
        </div>
      </div>
    </div>

    <!-- Tab 3: Additional Notes -->
    <div *ngIf="currentTab === 'notes'" class="tab-content">

      <div class="form-group">
        <label for="notes" class="form-label">Notes</label>
        <textarea
          id="notes"
          name="notes"
          class="form-input form-textarea"
          [(ngModel)]="editedDevice.notes"
          placeholder="Add any additional information..."
          rows="3"
        ></textarea>
      </div>
    </div>

    <!-- Tab 4: Documents -->
    <div *ngIf="currentTab === 'documents'" class="tab-content documents-tab">
      <!-- Upload Section -->
      <div class="upload-section">
        <div class="upload-header">
          <h4 class="upload-title">Device Documents</h4>
          <button type="button" class="upload-button" (click)="fileInput.click()">
            <span class="upload-icon">ğŸ“</span>
            Upload Document
          </button>
          <input
            #fileInput
            type="file"
            style="display: none"
            (change)="onFileSelected($event)"
            accept=".pdf,.jpg,.jpeg,.png,.doc,.docx"
            multiple
          />
        </div>
        <p class="upload-hint">Upload receipts, warranty documents, manuals, or photos</p>
      </div>

      <!-- Documents List -->
      <div class="documents-list">
        <!-- Loading State -->
        <div *ngIf="documentsLoading" class="loading-state">
          <div class="spinner"></div>
          <p>Loading documents...</p>
        </div>

        <!-- Empty State -->
        <div *ngIf="!documentsLoading && documents.length === 0" class="empty-state">
          <span class="empty-icon">ğŸ“„</span>
          <h4>No documents yet</h4>
          <p>Upload receipts, warranty docs, or photos for this device</p>
        </div>

        <!-- Documents Grid -->
        <div *ngIf="!documentsLoading && documents.length > 0" class="documents-grid">
          <div *ngFor="let doc of documents" class="document-card">
            <div class="doc-icon">ğŸ“„</div>
            <div class="doc-info">
              <div class="doc-name" [title]="doc.name">{{ doc.name }}</div>
              <div class="doc-meta">
                <span class="doc-size">{{ formatFileSize(doc.fileSize) }}</span>
                <span class="doc-date">{{ formatDate(doc.uploadDate) }}</span>
              </div>
            </div>
            <div class="doc-actions">
              <button type="button" class="doc-action-btn" (click)="downloadDocument(doc)" title="Download">
                â¬‡ï¸
              </button>
              <button type="button" class="doc-action-btn delete" (click)="deleteDocument(doc)" title="Delete">
                ğŸ—‘ï¸
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Upload Progress -->
      <div *ngIf="uploadProgress > 0 && uploadProgress < 100" class="upload-progress">
        <div class="progress-bar">
          <div class="progress-fill" [style.width.%]="uploadProgress"></div>
        </div>
        <span class="progress-text">Uploading... {{ uploadProgress }}%</span>
      </div>
    </div>

    <!-- Form Actions -->
    <div class="form-actions">
      <gc-button
        type="button"
        variant="secondary"
        (click)="onClose()"
        [disabled]="isSubmitting"
      >
        Cancel
      </gc-button>
      <gc-button
        type="submit"
        variant="primary"
        [disabled]="isSubmitting"
      >
        {{ isSubmitting ? 'Saving...' : 'Save Changes' }}
      </gc-button>
    </div>
  </form>
</gc-modal>
